<div class="card">
    <h1>ğŸ¢ ç¸½å…¬å¸å€‰åº«</h1>
    <div id="main-stock-display">è¼‰å…¥ä¸­...</div>
    <button onclick="location.href='scan.html'" style="background:#50c878;">ğŸ“· æƒææ–°é€²è²¨ç‰©</button>
</div>

<div class="card">
    <h2>ğŸ“ éŠ·å”®æ“šé»ç®¡ç†</h2>
    <div class="tabs">
        <button onclick="switchLocation('LOC_A')">åœ°é» A</button>
        <button onclick="switchLocation('LOC_B')">åœ°é» B</button>
    </div>
    <div id="location-inventory-list">
        <p>è«‹é¸æ“‡ä¸Šæ–¹åœ°é»æŸ¥çœ‹æ¸…å–®</p>
    </div>
</div>

<script>
    // 1. æŠ“å–ç¸½è¡¨æ•¸æ“š
    async function fetchSummary() {
        const res = await fetch('/api/stock');
        const data = await res.json();
        
        // æ¸²æŸ“å…¬å¸å€‰ (MAIN)
        const main = data.filter(i => i.location === 'MAIN');
        document.getElementById('main-stock-display').innerHTML = main.map(i => 
            `<p>${i.item_uuid.substring(0,12)}... : <b>${i.current_stock}</b> ä»¶</p>`
        ).join('') || "ç›®å‰ç„¡åº«å­˜";
        
        window.allData = data; // æš«å­˜èµ·ä¾†çµ¦åˆ‡æ›åœ°é»ç”¨
    }

    // 2. åˆ‡æ›åœ°é»é¡¯ç¤ºæ¸…å–®
    function switchLocation(loc) {
        const list = window.allData.filter(i => i.location === loc && i.current_stock > 0);
        const container = document.getElementById('location-inventory-list');
        
        container.innerHTML = `<h3>${loc} åœ¨åº«æ¸…å–®</h3>` + list.map(i => `
            <div class="stock-row">
                <span>${i.item_uuid.substring(0,12)}</span>
                <button onclick="doConsume('${i.item_uuid}', '${loc}')">éŠ·å¸³ -1</button>
            </div>
        `).join('');
    }

    // 3. éŠ·å¸³å‹•ä½œ
    async function doConsume(uuid, loc) {
        if(!confirm('ç¢ºèªæ¶ˆè€—æ­¤ç‰©æ–™ï¼Ÿ')) return;
        await fetch('/api/stock', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>åº«å­˜ç®¡ç†ç³»çµ± Ver. 2026.01.24</title>
<script src="https://accounts.google.com/gsi/client" async defer></script>
<style>
  :root { --primary: #007bff; --bg: #f8f9fa; }
  body { font-family: -apple-system, "Segoe UI", sans-serif; background: var(--bg); margin: 0; }
  
  /* å°è¦½åˆ— BAR */
  .navbar { background: white; padding: 10px 20px; display: flex; align-items: center; border-bottom: 1px solid #eee; box-shadow: 0 2px 5px rgba(0,0,0,0.05); position: sticky; top: 0; z-index: 1000; }
  .logo { font-size: 20px; font-weight: bold; color: #333; border-left: 4px solid var(--primary); padding-left: 10px; margin-right: 30px; }
  .nav-links { display: flex; gap: 10px; flex-grow: 1; }
  
  /* åœ“è§’æŒ‰éˆ• */
  .nav-btn { background: #f4f4f4; color: #666; border: none; padding: 10px 18px; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 500; display: flex; align-items: center; gap: 5px; transition: 0.2s; }
  .nav-btn:hover { background: #e9e9e9; }
  .nav-btn.active { background: var(--primary); color: white; box-shadow: 0 4px 10px rgba(0,123,255,0.3); }
  
  /* ç”¨æˆ¶è³‡è¨Š */
  .user-box { display: flex; align-items: center; gap: 10px; font-size: 13px; color: #666; }
  .user-avatar { width: 30px; height: 30px; border-radius: 50%; background: #ddd; }

  /* å…§å®¹å€åŸŸ */
  .main-container { padding: 20px; max-width: 1200px; margin: auto; }
  iframe { width: 100%; height: 85vh; border: none; border-radius: 12px; background: white; box-shadow: 0 4px 20px rgba(0,0,0,0.08); }

  /* ç™»å…¥é®ç½© */
  #login-overlay { position: fixed; inset: 0; background: white; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 2000; }
</style>
</head>
<body>

<div id="login-overlay">
    <h2>ğŸ” æ­¡è¿ä½¿ç”¨åº«å­˜ç³»çµ±</h2>
    <p>è«‹å…ˆç™»å…¥æ‚¨çš„ Gmail å¸³è™Ÿä»¥ç¹¼çºŒ</p>
    <div id="g_id_onload"
         data-client_id="YOUR_GOOGLE_CLIENT_ID.apps.googleusercontent.com"
         data-callback="handleCredentialResponse"
         data-auto_prompt="false">
    </div>
    <div class="g_id_signin" data-type="standard"></div>
</div>

<div class="navbar" id="app-bar" style="display:none;">
    <div class="logo">åº«å­˜ç³»çµ± <small style="font-weight:normal; font-size:12px; color:#999;">Ver. 2026</small></div>
    
    <div class="nav-links">
        <button class="nav-btn active" onclick="loadPage('list.html', this)">ğŸ“¦ åº«å­˜åˆ—è¡¨</button>
        <button class="nav-btn" onclick="loadPage('scan.html', this)">âœ¨ æ–°è²¨å…¥åº«</button>
        <button class="nav-btn" onclick="loadPage('transfer.html', this)">ğŸšš é€²å‡ºè²¨</button>
        <button class="nav-btn" onclick="loadPage('hospital.html', this)">ğŸ¥ é†«é™¢ç®¡ç†</button>
    </div>

    <div class="user-box">
        <span id="user-email">è¼‰å…¥ä¸­...</span>
        <img id="user-img" class="user-avatar" src="" alt="">
        <button onclick="logout()" style="background:none; border:none; color:red; cursor:pointer; font-size:12px;">ç™»å‡º</button>
    </div>
</div>

<div class="main-container" id="main-content" style="display:none;">
    <iframe id="content-frame" src="list.html"></iframe>
</div>

<script>
    // 1. Google ç™»å…¥è™•ç†
    function handleCredentialResponse(response) {
        const payload = parseJwt(response.credential);
        localStorage.setItem('user_email', payload.email);
        localStorage.setItem('user_name', payload.name);
        localStorage.setItem('user_img', payload.picture);
        showApp();
    }

    function parseJwt(token) {
        var base64Url = token.split('.')[1];
        var base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
        return JSON.parse(window.atob(base64));
    }

    function showApp() {
        document.getElementById('login-overlay').style.display = 'none';
        document.getElementById('app-bar').style.display = 'flex';
        document.getElementById('main-content').style.display = 'block';
        document.getElementById('user-email').innerText = localStorage.getItem('user_email');
        document.getElementById('user-img').src = localStorage.getItem('user_img');
    }

    // 2. åˆ‡æ›é é¢é‚è¼¯
    function loadPage(page, btn) {
        // æ›´æ–°æŒ‰éˆ•æ¨£å¼
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        
        // åˆ‡æ› iframe å…§å®¹
        document.getElementById('content-frame').src = page;
    }

    function logout() {
        localStorage.clear();
        location.reload();
    }

    // è‡ªå‹•æª¢æŸ¥æ˜¯å¦å·²ç™»å…¥
    window.onload = () => {
        if(localStorage.getItem('user_email')) showApp();
    };
</script>

</body>
</html>
            body: JSON.stringify({ item_uuid: uuid, from_loc: loc, to_loc: 'CONSUMED', operator: 'ç¾å ´æ¥­å‹™' })
        });
        alert('éŠ·å¸³æˆåŠŸï¼');
        location.reload(); // é‡æ–°æ•´ç†
    }

    fetchSummary();
</script>