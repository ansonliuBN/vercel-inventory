<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>OCR Test (NO MODULE)</title>
</head>
<body>

<h3>OCR Test</h3>
<input type="file" id="file" accept="image/*">
<pre id="out">頁面已載入\n</pre>

<!-- 不用 module，不用 import -->
<script src="/tesseract/tesseract.min.js"></script>

<script>
const out = document.getElementById("out");
const fileInput = document.getElementById("file");

out.textContent += "Tesseract global = " + (typeof Tesseract) + "\n";

let worker;

async function initWorker() {
  out.textContent += "初始化 worker...\n";

  worker = Tesseract.createWorker({
    workerPath: "/tesseract/worker.min.js",
    corePath: "/tesseract/tesseract-core.wasm",
    langPath: "/tessdata"
  });

  await worker.load();
  out.textContent += "worker loaded\n";

  await worker.loadLanguage("eng");
  out.textContent += "language loaded\n";

  await worker.initialize("eng");
  out.textContent += "worker initialized\n";
}

fileInput.addEventListener("change", async () => {
  const file = fileInput.files[0];
  if (!file) return;

  try {
    if (!worker) await initWorker();

    out.textContent += "開始 OCR...\n";
    const res = await worker.recognize(file);

    out.textContent += "\n--- OCR RESULT ---\n";
    out.textContent += res.data.text || "(no text)\n";

  } catch (e) {
    out.textContent += "\n❌ ERROR:\n" + e.message;
  }
});
</script>

</body>
</html>
