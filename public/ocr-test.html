<script src="/tesseract/tesseract.min.js"></script>

<script>
const out = document.getElementById("out");
const fileInput = document.getElementById("file");

out.textContent += "Tesseract global = " + (typeof Tesseract) + "\n";

let worker = null;

async function initWorker() {
  out.textContent += "初始化 worker...\n";

  worker = await Tesseract.createWorker({
    workerPath: "/tesseract/worker.min.js",
    corePath: "/tesseract/tesseract-core.wasm",
    langPath: "/tessdata",
    logger: m => {
      // console.log(m); // 有需要再打開
    }
  });

  out.textContent += "載入語言...\n";
  await worker.loadLanguage("eng");

  out.textContent += "初始化 OCR 引擎...\n";
  await worker.initialize("eng");

  out.textContent += "OCR worker ready ✅\n";
}

fileInput.addEventListener("change", async () => {
  const file = fileInput.files[0];
  if (!file) return;

  try {
    if (!worker) await initWorker();

    out.textContent += "開始 OCR...\n";
    const res = await worker.recognize(file);

    out.textContent += "\n--- OCR RESULT ---\n";
    out.textContent += res.data.text || "(no text)\n";

  } catch (e) {
    out.textContent += "\n❌ ERROR:\n" + e.message;
  }
});
</script>
