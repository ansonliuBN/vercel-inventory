<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>OCR Test (Tesseract v5)</title>
</head>
<body>

<h3>OCR Test</h3>
<input type="file" id="file" accept="image/*">
<pre id="out"></pre>

<script type="module">
import { createWorker } from "/tesseract/tesseract.esm.min.js";

const out = document.getElementById("out");
const fileInput = document.getElementById("file");

let worker = null;

async function getWorker() {
  if (worker) return worker;

  out.textContent += "建立 worker...\n";

  worker = await createWorker({
    workerPath: "/tesseract/worker.min.js",
    corePath: "/tesseract/tesseract-core.wasm",
    langPath: "/tessdata",
    logger: m => {
      // 可開啟觀察進度
      // console.log(m);
    }
  });

  out.textContent += "載入語言...\n";
  await worker.loadLanguage("eng");

  out.textContent += "初始化引擎...\n";
  await worker.initialize("eng");

  out.textContent += "設定 OCR 參數...\n";
  await worker.setParameters({
    tessedit_char_whitelist: "0123456789()ABCDEFGHIJKLMNOPQRSTUVWXYZ-",
    tessedit_pageseg_mode: "7" // SINGLE_LINE
  });

  out.textContent += "OCR worker ready ✅\n\n";
  return worker;
}

fileInput.addEventListener("change", async () => {
  const file = fileInput.files[0];
  if (!file) return;

  try {
    const w = await getWorker();

    out.textContent += "開始 OCR...\n";
    const res = await w.recognize(file);

    out.textContent += "\n--- OCR RESULT ---\n";
    out.textContent += res.data.text || "(no text)\n";

  } catch (err) {
    out.textContent += "\n❌ ERROR:\n" + err.message;
  }
});
</script>

</body>
</html>
