<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>Sharp + Tesseract Debug æ¸¬è©¦å·¥å…·</title>
    <style>
        body { font-family: sans-serif; text-align: center; padding: 20px; background: #f0f2f5; }
        .container { max-width: 900px; margin: auto; background: white; padding: 20px; border-radius: 12px; }
        .debug-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-top: 20px; }
        .debug-card { border: 1px solid #ddd; padding: 10px; border-radius: 8px; }
        .debug-card img { width: 100%; border-radius: 4px; background: #eee; }
        .result-box { margin-top: 20px; padding: 15px; background: #eef; border-radius: 8px; font-size: 1.2rem; font-weight: bold; color: #333; }
        #loader { display: none; color: #7360f2; font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <h2>ğŸ” Sharp + Tesseract å½±åƒè¾¨è­˜ Debug</h2>
    <p>ä¸Šå‚³æ¢ç¢¼ç…§ç‰‡ï¼ŒæŸ¥çœ‹ Sharp å¦‚ä½•ã€Œä¿®åœ–ã€çµ¦ Tesseract çœ‹</p>
    
    <input type="file" id="fileInput" accept="image/*" onchange="startTest()">
    <div id="loader">ğŸ”„ å½±åƒè™•ç†èˆ‡ OCR é€²è¡Œä¸­...</div>

    <div class="result-box">
        è¾¨è­˜æ–‡å­—çµæœï¼š<span id="ocrText">ç­‰å¾…ä¸Šå‚³...</span>
    </div>

    <div class="debug-grid">
        <div class="debug-card">
            <b>1. åŸºæœ¬å¢å¼· (Base)</b>
            <img id="imgBase">
            <p><small>ç°éš + ç¸®æ”¾</small></p>
        </div>
        <div class="debug-card">
            <b>2. äºŒå€¼åŒ– (Threshold)</b>
            <img id="imgThreshold">
            <p><small>éæ¿¾åå…‰èˆ‡é›œè¨Š</small></p>
        </div>
        <div class="debug-card">
            <b>3. éŠ³åŒ– (Sharpen)</b>
            <img id="imgSharp">
            <p><small>å¼·åŒ–æ–‡å­—é‚Šç·£</small></p>
        </div>
    </div>
</div>

<script>
    async function startTest() {
        const file = document.getElementById('fileInput').files[0];
        if (!file) return;

        const loader = document.getElementById('loader');
        loader.style.display = 'block';

        // è½‰ Base64
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = async () => {
            const base64 = reader.result;

            try {
                const res = await fetch('/api/test-ocr', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ image: base64 })
                });

                const data = await res.json();
                
                // é¡¯ç¤ºè¾¨è­˜æ–‡å­—
                document.getElementById('ocrText').innerText = data.rawText || "æœªè¾¨è­˜åˆ°æ–‡å­—";
                
                // é¡¯ç¤ºä¸‰å¼µ Debug å½±åƒ
                document.getElementById('imgBase').src = "data:image/jpeg;base64," + data.debugImages.base;
                document.getElementById('imgThreshold').src = "data:image/jpeg;base64," + data.debugImages.threshold;
                document.getElementById('imgSharp').src = "data:image/jpeg;base64," + data.debugImages.sharp;

            } catch (err) {
                alert("éŒ¯èª¤: " + err.message);
            } finally {
                loader.style.display = 'none';
            }
        };
    }
</script>

</body>
</html>